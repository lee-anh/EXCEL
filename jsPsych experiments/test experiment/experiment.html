<!DOCTYPE html>
<html>
    <head>
        <title>Experiment</title>
        <script src = "jspsych/jspsych.js"></script>
        <script src = "jspsych/plugins/jspsych-html-keyboard-response.js"></script>
        <script src = "jspsych/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych/plugins/jspsych-preload.js"></script>
        <script src = "jspsych/plugins/jspsych-instructions.js"></script>
        <link href = "jspsych/css/jspsych.css" rel = "stylesheet">

    </head>

    <body> </body>

    <script>

        
        var timeline = [];
        var preload = {
            type: 'preload',
            images: ['img/up-arrow.png', 'img/down-arrow.png']
        }
        timeline.push(preload);

        var instructions = {
            type: 'instructions',
            pages: ['Welcome!', '<p>Press the up key when you see an up arrow and down when you see a down arrow</p> <p> Click the next button to start</p>'],
            show_clickable_nav: true
        }
        timeline.push(instructions);



        var visual_alert_trial = {
            type: 'image-keyboard-response', 
            stimulus: jsPsych.timelineVariable('stimulus'),
            choices: ['u', 'd'],
            stimulus_duration: 500, 
            trial_duration: 2000,
            data: {condition: jsPsych.timelineVariable('condition'), 
                    correct_response: jsPsych.timelineVariable('correct_response')},

            on_finish: function(data){
                var accuracy = false;
                if(data.correct_response == data.response){
                    accuracy = true;

                }
                data.accuracy = accuracy;
            }
        };

        var feedback = {
            type: 'html-keyboard-response', 
            stimulus: function() {
                var feedback_text = "Incorrect";
                var last_trial_accuracy = jsPsych.data.getLastTrialData().values()[0].accuracy;
                if(last_trial_accuracy == true){
                    feedback_text = "Correct!"
                }

                return feedback_text
            }, 
            choices: jsPsych.NO_KEYS,
            trial_duration: 2000
        }

        var delay = {
            type: 'html-keyboard-response',
            stimulus: "delay", 
            choices: jsPsych.NO_KEYS,
            trial_duration: function(){
                return Math.floor(Math.random() * (15000 - 6000 + 1000) + 6000);
            }
        }

        var trial_info = [
            {stimulus: "img/up-arrow.png", condition: 'up', correct_response: 'u'}, 
            {stimulus:"img/down-arrow.png", condition: 'down', correct_response: 'd'}

        ];
        
        var visual_procedure = {
            timeline: [visual_alert_trial, feedback, delay], 
            timeline_variables: trial_info, 
            randomize_order: true,
            sample: {
                type: 'with-replacement', 
                size: 16
            }

        }
        timeline.push(visual_procedure);

        jsPsych.init({
            timeline: timeline, 
            on_finish: function(){
                jsPsych.data.displayData();
            }
        })


        function generateRandomVisStimulus(){
            var arrow = ["img/up-arrow.png", "img/down-arrow.png"];
            var chosen = jsPsych.randomization.sampleWithReplacement(arrow, 1);
            return chosen; 

        }
    </script>

</html>